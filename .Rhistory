mct4_cat <- cut(mct4_cat, breaks = c(-Inf, median(mct4_cat, na.rm = T), Inf), labels=c("Low", "High"))
match_pos <- match(ordered_patients, samples$sample)
ciber_samples <- ciber$Input.Sample
ciber_mtx <- ciber[ciber$Input.Sample %in% ordered_patients,!colnames(ciber) %in% c("Input.Sample", "RMSE", "Pearson.Correlation", "P.value")]
dim(ciber_mtx)
length(ciber_samples)
merged <- readRDS("merged_skcm_df.rds")
mct4_cat <- merged$SLC16A3
names(mct4_cat) <- merged$patient
mct4_cat <- sort(mct4_cat, decreasing = T)
ordered_patients <- names(mct4_cat)
mct4_cat <- cut(mct4_cat, breaks = c(-Inf, median(mct4_cat, na.rm = T), Inf), labels=c("Low", "High"))
match_pos <- match(ordered_patients, samples$sample)
ciber_mtx <- ciber[ciber$Input.Sample %in% ordered_patients,]
ciber_samples <- ciber$Input.Sample
ciber_mtx <- ciber[, !colnames(ciber) %in% c("Input.Sample", "RMSE", "Pearson.Correlation", "P.value")
rownames(ciber_mtx) <- ciber_samples
mct4_cat <- merged$SLC16A3
names(mct4_cat) <- merged$patient
mct4_cat <- sort(mct4_cat, decreasing = T)
ordered_patients <- names(mct4_cat)
mct4_cat <- cut(mct4_cat, breaks = c(-Inf, median(mct4_cat, na.rm = T), Inf), labels=c("Low", "High"))
match_pos <- match(ordered_patients, samples$sample)
ciber_mtx <- ciber[ciber$Input.Sample %in% ordered_patients,]
ciber_samples <- ciber$Input.Sample
ciber_mtx <- ciber[, !colnames(ciber) %in% c("Input.Sample", "RMSE", "Pearson.Correlation", "P.value")]
rownames(ciber_mtx) <- ciber_samples
ciber_mtx <- t(ciber_mtx)
annot_col <- data.frame(subtype=samples$group[match_pos],
mct4 = mct4_cat,
row.names = samples$sample[match_pos])
annot_color <- list(subtype = c("immune"="red", "keratin"="deepskyblue3", "MITF_low"="gold", "na"="white"),
mir155 = c("High" = "coral", "Low"="steelblue"),
mct4 = c("High" = "coral", "Low"="steelblue"))
ciber_mtx <- ciber_mtx[, ]
pheatmap(ciber_mtx, show_rownames = T, show_colnames = F, scale= "column",
color = colorRampPalette(rev(brewer.pal(n = 7, name ="RdBu")))(100),
annotation_col = annot_col, annotation_colors = annot_color, cluster_cols = F,
clustering_distance_rows = "euclidean", clustering_distance_cols = "euclidean",
clustering_method = "ward.D2", cutree_cols = 2)
ciber_mtx <- ciber_mtx[ordered_patients, ]
rownames(ciber_mtx)
ciber_mtx <- ciber_mtx[, ordered_patients]
pheatmap(ciber_mtx, show_rownames = T, show_colnames = F, scale= "column",
color = colorRampPalette(rev(brewer.pal(n = 7, name ="RdBu")))(100),
annotation_col = annot_col, annotation_colors = annot_color, cluster_cols = F,
clustering_distance_rows = "euclidean", clustering_distance_cols = "euclidean",
clustering_method = "ward.D2", cutree_cols = 2)
plot(merged$CD3E, merged$SLC16A3)
plot(merged$CD8A, merged$SLC16A3)
suppressPackageStartupMessages(library(ggpubr))
ggscatter(merged, x="SLC16A3", y= "CD3E")
ggscatter(merged, x="SLC16A3", y= "CD3E", add = "reg.line", add.params = list(color=red), cor.coef = T)
ggscatter(merged, x="SLC16A3", y= "CD3E", add = "reg.line", add.params = list(color="red"), cor.coef = T)
ggscatter(merged, x="SLC16A3", y= c("CD3E", "CD8A"), add = "reg.line", add.params = list(color="red"), cor.coef = T)
ggscatter(merged, x="SLC16A3", y= c("CD3E", "CD8A"), add = "reg.line", add.params = list(color="red"), cor.coef = T, cor.coeff.args = list(color="red"))
ggscatter(merged, x="SLC16A3", y= c("CD3E", "CD8A"), add = "reg.line", add.params = list(color="red"), cor.coef = T, cor.coeff.args = list(color="red"))
ggscatter(merged, x="SLC16A3", y= c("CD3E", "CD8A"), add = "reg.line", add.params = list(color="red"), cor.coef = T, cor.coeff.args = list(color="red"))
View(ciber_rna[1:10,1:10])
dim(ciber_rna)
colnames(ciber_rna)[1:20]
colnames(ciber_rna)[1:50]
ggscatter(ciber_rna, "CD3E", "T.cells.CD8")
ggscatter(ciber_rna, "CD3E", "T.cells.CD8", add="loess")
ggscatter(ciber_rna, "CD3E", "T.cells.CD8", add="loess", cor.method = "kendall")
ggscatter(ciber_rna, "CD3E", "T.cells.CD8", add="loess", cor.method = "kendall", cor.coef = T)
reg.line(ciber_rna, "CD3E", "T.cells.CD8", add="loess", cor.method = "kendall", cor.coef = T)
ggscatter(ciber_rna, "CD3E", "T.cells.CD8", add="reg.line", cor.method = "kendall", cor.coef = T)
ggscatter(ciber_rna, "CD3E", "B.cells.naive", add="reg.line", cor.method = "kendall", cor.coef = T)
ggscatter(ciber_rna, "Macrophages.M2", "T.cells.CD8", add="reg.line", cor.method = "kendall", cor.coef = T)
ggscatter(ciber_rna, "Macrophages.M1", "T.cells.CD8", add="reg.line", cor.method = "kendall", cor.coef = T)
ggscatter(ciber_rna, "Macrophages.M0", "T.cells.CD8", add="reg.line", cor.method = "kendall", cor.coef = T)
cor_ciber <- cor(ciber_rna[,2:20])
library(factoextra)
library(corrplot)
corrplot::corrplot(cor_ciber)
corrplot::corrplot(cor_ciber, method = "pie")
corrplot::corrplot(cor_ciber, method = "color")
corrplot::corrplot(cor_ciber, method = "shade")
corrplot::corrplot(cor_ciber, method = "ellipse")
corrplot::corrplot(cor_ciber, method = "square")
dim(ciber_rna)
anyDuplicated()ciber$Input.Sample
anyDuplicated(ciber$Input.Sample)
anyNA(ciber$Input.Sample)
dim(cibe)
dim(cibe)
dim(ciber)
cor_dat <- cor(ciber)
ciber
cor_dat <- cor(ciber[, colnames(ciber) != "Input.Sample"])
?corrplot
corrplot(cor_dat, method="circle" )
corrplot(cor_dat, method="circle", tl.col="black" )
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 1 )
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.2 )
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.5 )
cor_dat <- cor(ciber[, !colnames(ciber) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE"])
cor_dat <- cor(ciber[, !colnames(ciber) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE")])
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.5 )
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 )
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 , type="upper")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 , type="upper", hclust.method = "ward.D2")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 , type="full", hclust.method = "ward.D2")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 , type="full", hclust.method = "ward.D2", addshade = "positive")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 , type="full", hclust.method = "ward.D2", addshade = "positive")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 , type="full", hclust.method = "ward.D2", addshade = "negative")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 , type="full", hclust.method = "ward.D2", addshade = "negative")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 , type="full", hclust.method = "ward.D2", addshade = "positive")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 , type="full", hclust.method = "ward.D2", addrect = T)
corrplot.mixed(cor_dat)
cor_dat <- cor(ciber[, !colnames(ciber) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE")], method = "pearson")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 , type="full", hclust.method = "ward.D2", )
cor_dat <- cor(ciber[, !colnames(ciber) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE")], method = "spearman")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 , type="full", hclust.method = "ward.D2", )
?cor
cor_dat <- cor(ciber[, !colnames(ciber) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE")], method = "kendall")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 , type="full", hclust.method = "ward.D2", )
cor_dat <- cor(ciber[, !colnames(ciber) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE")], method = "pearson")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 , type="full", hclust.method = "ward.D2", )
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.6 , type="full", hclust.method = "ward.D2", )
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.7 , type="full", hclust.method = "ward.D2", )
suppressPackageStartupMessages(library(corrplot))
cor_dat <- cor(ciber[, !colnames(ciber) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE")], method = "pearson")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.8 , type="full", hclust.method = "ward.D2", )
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.8 , type="full", hclust.method = "ward.D2", order="hclust")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.8 , type="full", hclust.method = "ward.D2", order="alphabet")
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.8 , type="full", hclust.method = "ward.D2", order="alphabet", addrect = 3)
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.8 , type="full", hclust.method = "ward.D2", order="hclust", addrect = 3)
corrplot(cor_dat, method="circle", tl.col="black", tl.cex = 0.8 , type="full", hclust.method = "ward.D2", order="hclust", addrect = 6)
corrplot(cor_dat, type="lower, method="circle", tl.col="black", tl.cex = 0.8 , type="full", hclust.method = "ward.D2", order="hclust", addrect = 6)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8 , type="full", hclust.method = "ward.D2", order="hclust", addrect = 6)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8  hclust.method = "ward.D2", order="hclust", addrect = 6)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="hclust", addrect = 6)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", addrect = 6)
corrplot(cor_dat, type="lower" , method="square", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet")
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet")
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", addCoefasPercent = T)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet",addCoef.col = "red", addCoefasPercent = T)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet",addCoef.col = "red", addCoefasPercent = T)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT")
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT")
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(1,1,1,1))
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(1,0,0,0))
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,1,0,0))
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,1,0))
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.5,0))
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0))
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), sig.level = T)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), sig.level = T, p.mat=T)
colnames(cor_dat)
rownames(cor_dat)
?cor.mtest
cor.mtest(ciber[, !colnames(ciber) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE")])
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), sig.level = T, p.mat=p_mat)
p_mat <- cor.mtest(ciber[, !colnames(ciber) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE")])
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), sig.level = T, p.mat=p_mat)
dim(p_mat)
class(p_mat)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), sig.level = T, p.mat=p_mat$p)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), sig.level = 0.05, p.mat=p_mat$p)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, )
dim(p_mat$p)
p_mat <- cor.mtest(ciber[, !colnames(ciber) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE")], conf.level=0.95)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05)
dimnames(p_mat$p) <- rownames(cor_dat)
dimnames(p_mat$p) <- list(rownames(cor_dat), rownames(cor_dat)
)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig="blank")
p_mat$p
min(p_mat$p)
max(p_mat$p)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.1)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.6)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig")
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.1)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.4)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8, plotCI = T)
corrplot(cor_dat, type="lower" , method="circle", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8)
corrplot(cor_dat, type="lower" , method="color", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8)
corrplot(cor_dat, type="lower" , method="color", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8, addgrid.col = "darkgray")
corrplot(cor_dat, type="lower" , method="color", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="hclust", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8, addgrid.col = "darkgray")
corrplot(cor_dat, type="lower" , method="color", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8, addgrid.col = "darkgray")
colnames(ciber_rna)[1:50]
colnames(ciber)
mtx <- ciber_rna[, c(colnames(ciber), "SLC16A3")]
c(colnames(ciber), "SLC16A3")
colnames(ciber_rna) <- gsub("Monocytes.x", "", colnames(ciber_rna))
mtx <- ciber_rna[, c(colnames(ciber), "SLC16A3")]
colnames(ciber_rna)[1:25]
suppressPackageStartupMessages(library(pheatmap))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(RColorBrewer))
ciber <- read.csv("CIBERSORT.Output_Job2.csv")
samples <- readRDS("voom_sample_df_rnaseq.rds")
landscape <- readxl::read_xlsx("Thorsson_Immunity_2018_TableS1.xlsx")
rna <- as.data.frame(t(as.data.frame(readRDS("voom_norm_expr_rnaseq.rds"))))
rna$sample <- rownames(rna)
samples$sample <- rownames(samples)
ciber_rna <- left_join(ciber, rna, by=c("Input.Sample" = "sample"))
ciber_rna <- left_join(ciber_rna, samples, by=c("Input.Sample"="sample"))
ciber_rna <- left_join(ciber_rna, landscape, by=c("Input.Sample"="TCGA Participant Barcode"))
colnames(ciber_rna) <- gsub("\\-", "_", colnames(ciber_rna))
colnames(ciber_rna) <- gsub(" ", "_", colnames(ciber_rna))
colnames(ciber_rna) <- gsub("Monocytes.x", "Monocytes", colnames(ciber_rna))
colnames(ciber_rna)[1:125]
colnames(ciber_rna)[1:25]
mtx <- ciber_rna[, c(colnames(ciber), "SLC16A3")]
cor_dat <- cor(mtx, method = "pearson")
mtx <- mtx[, !colnames(mtx) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE")]
cor_dat <- cor(mtx, method = "pearson")
p_mat <- cor.mtest(mtx, conf.level=0.95)
corrplot(cor_dat, type="lower" , method="color", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8, addgrid.col = "darkgray")
rownames(mtx)
colwnames(mtx)
colnames(mtx)
dimnames(cor_dat)
dimnames(p_mat) <- dimnames(cor_dat)
corrplot(cor_dat, type="lower" , method="color", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8, addgrid.col = "darkgray")
dimnames(p_mat) <- dimnames(cor_dat)
dimnames(p_mat) <- list(dimnames(cor_dat))
dimnames(cor_dat)
dimnames(p_mat)
dimnames(p_mat) <- list(rownames(cor_dat), rownames(cor_dat)
corrplot(cor_dat, type="lower" , method="color", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8, addgrid.col = "darkgray")
dimnames(p_mat) <- list(rownames(cor_dat), rownames(cor_dat))
dimnames(p_mat$p) <- dimnames(cor_dat)
corrplot(cor_dat, type="lower" , method="color", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8, addgrid.col = "darkgray")
corrplot(cor_dat, type="lower" , method="color", tl.col="black", tl.cex = 0.8, tl.pos = "d",  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8, addgrid.col = "darkgray")
corrplot(cor_dat, type="lower" , method="color", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8, addgrid.col = "darkgray")
reorder_cols <- colnames(mtx)
sort(colnames(mtx))
reorder_cols <- c(sort(colnames(mtx)[colnames(mtx)!= "SLC16A3"]), "SLC16A3")
cor_dat <- cor(mtx, method = "pearson")
p_mat <- cor.mtest(mtx, conf.level=0.95)
mtx <- mtx[, reorder_cols]
suppressPackageStartupMessages(library(corrplot))
# mtx <- ciber[, !colnames(ciber) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE")]
mtx <- ciber_rna[, c(colnames(ciber), "SLC16A3")]
mtx <- mtx[, !colnames(mtx) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE")]
reorder_cols <- colnames(mtx)
reorder_cols <- c(sort(colnames(mtx)[colnames(mtx)!= "SLC16A3"]), "SLC16A3")
mtx <- mtx[, reorder_cols]
cor_dat <- cor(mtx, method = "pearson")
p_mat <- cor.mtest(mtx, conf.level=0.95)
dimnames(p_mat$p) <- dimnames(cor_dat)
corrplot(cor_dat, type="lower" , method="color", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="alphabet", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8, addgrid.col = "darkgray")
corrplot(cor_dat, type="lower" , method="color", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="original", title="Correlation between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8, addgrid.col = "darkgray")
suppressPackageStartupMessages(library(corrplot))
mtx <- ciber_rna[, c(colnames(ciber), "SLC16A3")]
mtx <- mtx[, !colnames(mtx) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE")]
reorder_cols <- colnames(mtx)
reorder_cols <- c(sort(colnames(mtx)[colnames(mtx)!= "SLC16A3"]), "SLC16A3")
mtx <- mtx[, reorder_cols]
cor_dat <- cor(mtx, method = "spearman")
p_mat <- cor.mtest(mtx, conf.level=0.95)
dimnames(p_mat$p) <- dimnames(cor_dat)
corrplot(cor_dat, type="lower" , method="color", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="original", title="Spearman cor. between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8, addgrid.col = "darkgray")
suppressPackageStartupMessages(library(corrplot))
mtx <- ciber_rna[, c(colnames(ciber), "SLC16A3")]
mtx <- mtx[, !colnames(mtx) %in% c("Input.Sample","P.value", "Pearson.Correlation", "RMSE")]
reorder_cols <- colnames(mtx)
reorder_cols <- c(sort(colnames(mtx)[colnames(mtx)!= "SLC16A3"]), "SLC16A3")
mtx <- mtx[, reorder_cols]
cor_dat <- cor(mtx, method = "kendall")
p_mat <- cor.mtest(mtx, conf.level=0.95)
dimnames(p_mat$p) <- dimnames(cor_dat)
corrplot(cor_dat, type="lower" , method="color", tl.col="black", tl.cex = 0.8,  hclust.method = "ward.D2", order="original", title="Kendall cor. between immune cells from CIBERSORT", mar = c(0,0,0.75,0), p.mat=p_mat$p, sig.level = 0.05, insig = "label_sig", pch.cex = 0.8, addgrid.col = "darkgray")
merged <- readRDS("merged_skcm_df.rds")
mct4_org <- merged$SLC16A3
names(mct4_org) <- merged$patient
mct4_org <- sort(mct4_org, decreasing = T)
ordered_patients <- names(mct4_org)
mct4_cat <- cut(mct4_org, breaks = c(-Inf, median(mct4_org, na.rm = T), Inf), labels=c("Low", "High"))
match_pos <- match(ordered_patients, samples$sample)
ciber_mtx <- ciber[ciber$Input.Sample %in% ordered_patients,]
ciber_samples <- ciber$Input.Sample
ciber_mtx <- ciber[, !colnames(ciber) %in% c("Input.Sample", "RMSE", "Pearson.Correlation", "P.value")]
rownames(ciber_mtx) <- ciber_samples
ciber_mtx <- t(ciber_mtx)
annot_col <- data.frame(subtype=samples$group[match_pos],
mct4 = mct4_cat,
row.names = samples$sample[match_pos])
annot_color <- list(subtype = c("immune"="red", "keratin"="deepskyblue3", "MITF_low"="gold", "na"="white"),
mir155 = c("High" = "coral", "Low"="steelblue"),
mct4 = c("High" = "coral", "Low"="steelblue"))
ciber_mtx <- ciber_mtx[, ordered_patients]
pheatmap(ciber_mtx, show_rownames = T, show_colnames = F, scale= "column",
color = colorRampPalette(rev(brewer.pal(n = 7, name ="RdBu")))(100),
annotation_col = annot_col, annotation_colors = annot_color, cluster_cols = F,
clustering_distance_rows = "euclidean", clustering_distance_cols = "euclidean",
clustering_method = "ward.D2", cutree_cols = 2)
annot_col <- data.frame(subtype=samples$group[match_pos],
mct4 = mct4_cat,
mct4_expr = mct4_org,
row.names = samples$sample[match_pos])
annot_color <- list(subtype = c("immune"="red", "keratin"="deepskyblue3", "MITF_low"="gold", "na"="white"),
mir155 = c("High" = "coral", "Low"="steelblue"),
mct4 = c("High" = "coral", "Low"="steelblue"))
ciber_mtx <- ciber_mtx[, ordered_patients]
pheatmap(ciber_mtx, show_rownames = T, show_colnames = F, scale= "column",
color = colorRampPalette(rev(brewer.pal(n = 7, name ="RdBu")))(100),
annotation_col = annot_col, annotation_colors = annot_color, cluster_cols = F,
clustering_distance_rows = "euclidean", clustering_distance_cols = "euclidean",
clustering_method = "ward.D2", cutree_cols = 2)
shiny::runApp('C:/OConnell Lab/R analyses/Shiny Apps/CIPR')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v4')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/CIPR')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
grepl("logFC", "logFC Spearman")
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
View(trim_dat[1:10,1:10])
View(trim_ref[1:10,1:10])
rownames(trim_dat)
tail(trim_dat)
tail(trim_ref)
ref_data() -> ref_dataa
user_data() -> user_dataa
anyDuplicated(user_dataa$gene)
sum(duplicated(user_dataa$gene))
which(duplicated(user_dataa$gene) | duplicated(user_dataa$gene, fromLast = T))
user_dataa[which(duplicated(user_dataa$gene) | duplicated(user_dataa$gene, fromLast = T)), ]
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
ref_data() -> ref_dataa
user_data() -> user_dataa
anyDuplicated(user_dataa$gene)
sum(duplicated(user_dataa$gene))
which(duplicated(user_dataa$gene) | duplicated(user_dataa$gene, fromLast = T))
user_dataa[which(duplicated(user_dataa$gene) | duplicated(user_dataa$gene, fromLast = T)), ]
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
ref_data() -> ref_dataa
user_data() -> user_dataa
anyDuplicated(user_dataa$gene)
sum(duplicated(user_dataa$gene))
which(duplicated(user_dataa$gene) | duplicated(user_dataa$gene, fromLast = T))
user_dataa[which(duplicated(user_dataa$gene) | duplicated(user_dataa$gene, fromLast = T)), ]
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
runApp()
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
user_data() -> userr
userr$gene
anyDuplicated(userr$gene)
duplicated(dat[,gene_column])
duplicated(userr[,gene_column])
sum(duplicated(userr[,gene_column]))
length(duplicated(userr[,gene_column]))
dim(userr)
anyDuplicated(common_genes)
anyDuplicated(dat_genes)
userr[, "gene"]
a <- userr[!duplicated(userr[, "gene"])]
a <- userr[!duplicated(userr[, "gene"]), ]
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
colnames(trim_dat)
user_data()-> userr
colnames(userr)
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
shiny::runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
runApp('C:/OConnell Lab/R analyses/Shiny Apps/Cell_identity_predictor_OLD/CIPR_deploy/CIPR_v5')
sdfgsdfg
sdfg
sd
fg
sdf
gs
dfg
sdf
gs
dfg
sdf
g
sdfg
sd
fg
sdf
gsd
fg
sdf
gs
dfg
sd
fg
sdf
gs
dfg
sd
files <- list.files("CIPR outputs/", full.names = T)
dat_list <- list()
for(i in files){
name <- gsub("CIPR outputs/|\\.csv", "", i)
dat_list[[name]] <- read.csv(i)
}
require(UpSetR)
clus < 3
clus <- 3
df <- dat_list$andrew_allgenes_pearson
df %>%
filter(cluster == clus) %>%
top_n(10, wt=identity_score) %>%
pull(var_to_extract) %>%
as.character()
require(dplyr)
df_org <- df
df %>%
filter(cluster == clus) %>%
top_n(10, wt=identity_score) %>%
pull(var_to_extract) %>%
as.character()
var_to_extract = "reference_id"
df %>%
filter(cluster == clus) %>%
top_n(10, wt=identity_score) %>%
pull(var_to_extract) %>%
as.character()
var_to_extract = "reference_cell_type"
df %>%
filter(cluster == clus) %>%
top_n(10, wt=identity_score) %>%
pull(var_to_extract) %>%
as.character()
require(UpSetR)
var_to_extract = "reference_id"
top_extract <- function(df, clus, var_to_extract = "reference_id"){
require(dplyr)
df %>%
filter(cluster == clus) %>%
top_n(10, wt=identity_score) %>%
pull(var_to_extract) %>%
as.character()
}
list_subset <- lapply(comp_list, top_extract, clus=clus, var_to_extract)
comp_list <- dat_list[1:5]
list_subset <- lapply(comp_list, top_extract, clus=clus, var_to_extract)
upset(data=list_subset)
upset(fromList(list_subset))
upset(fromList(list_subset), text.scale = 2)
upset(fromList(list_subset), text.scale = 2,set_size.show = F)
upset(fromList(list_subset), text.scale = 2)
upset(fromList(list_subset), text.scale = 1.75)
upset(fromList(list_subset), text.scale = 1.75, mainbar.y.label = "test")
paste("a/n")
paste("a\na")
paste("a\naa")
message("a/na")
message("a\na")
upset(fromList(list_subset), text.scale = 1.75, mainbar.y.label = paste("Cluster", clus,"\n", var_to_extract, "overlap"))
top_plotter <- function(comp_list, clus, var_to_extract, ... ){
require(UpSetR)
list_subset <- lapply(comp_list, top_extract, clus=clus, var_to_extract)
upset(fromList(list_subset), text.scale = 1.75, mainbar.y.label = paste("Cluster", clus,"\n", var_to_extract, "overlap"))
}
datasets <- grep("andrew", names(dat_list), ignore.case = T, value = T)
clusters <- levels(factor(dat_list[[datasets[1]]]$cluster))
for(i in clusters){
top_plotter(dat_list[datasets], var_to_extract = "reference_id", clus = i)
}
top_plotter <- function(comp_list, clus, var_to_extract, ... ){
require(UpSetR)
list_subset <- lapply(comp_list, top_extract, clus=clus, var_to_extract)
upset(fromList(list_subset), text.scale = 1.75, mainbar.y.label = paste("Cluster", clus,"\n", var_to_extract, "overlap"), ...)
}
top_plotter(dat_list[datasets], var_to_extract = "reference_id", clus = i)
top_plotter(dat_list[datasets], var_to_extract = "reference_id", clus = i)
top_plotter(dat_list[datasets], var_to_extract = "reference_id", clus = i)
top_plotter(dat_list[datasets], var_to_extract = "reference_id", clus = i)
top_plotter(dat_list[datasets], var_to_extract = "reference_id", clus = i)
var_to_extract <- "reference_cell_type"
df %>%
filter(cluster == clus) %>%
top_n(10, wt=identity_score) %>%
pull(var_to_extract) %>%
as.character()
combined <- UpdateSeuratObject(readRDS("combined.rds"))
suppressPackageStartupMessages(library(Seurat))
combined <- UpdateSeuratObject(readRDS("combined.rds"))
suppressPackageStartupMessages(library(Seurat))
combined <- UpdateSeuratObject(readRDS("combined.rds"))
combined$renamed_ident <- Idents(combined)
Idents(combined) <- factor(combined$res.0.7, gtools::mixedsort(levels(factor(combined$res.0.7))))
avg_exp <- AverageExpression(combined)
avg_exp <- avg_exp$RNA
avg_exp$gene <- rownames(avg_exp)
head(avg_exp)
head(avg_exp[, 1:5])
head(avg_exp[, 10:15])
log(0.2)
log(0)
# v5 ====> copied from v4 and v3
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
immgen <- readRDS("data/immgen.rds")
View(immgen[1:10,1:5])
View(immgen[1:10,1:6])
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
